<%- include('../partials/header.ejs') %>

<div class="post">
    <h2 class="post-title"><%=post.title %></h2>
    <h4>Spotted by <%= post.poster %> on <%= days[post.createdAt.getUTCDay()] %> <%= months[post.createdAt.getUTCMonth()] %> 
        <%= post.createdAt.getUTCDate() %> <%= post.createdAt.getUTCFullYear() %> 
        <%= post.createdAt.getUTCHours() - (post.createdAt.getTimezoneOffset() / 60) %>:<%= post.createdAt.getUTCMinutes() %></h4>
    <img class="full-cat" src="<%= post.img %>"/>
    <p class="description"><%= post.description %></p>
    <% if (post.latitude !== null && post.longitude !== null && post.location !== "Unlisted") { %>
        <div id="show-map"></div>
    <% } %>
    <h3>Spotted in <%= post.location %></h3>
    <% if (currentUser && currentUser.username === post.poster) { %>
        <div class="modify-buttons">
            <a href="/catspotting/<%= post._id %>/edit"><button type="button">Edit Post</button></a>
            <form action="/catspotting/<%= post._id %>?_method=DELETE" method="POST">
                <button id="delete-button" type="submit">Delete Post</button>
            </form>
        </div>
    <% } %>
    <a class="go-back" href="/catspotting">Go Back</a>
</div>
<script type="text/javascript">
    function showMap() {
        //Google Map initializer
        const myLatlng = { lat: <%= post.latitude %>, lng: <%= post.longitude %> };
        const map = new google.maps.Map(document.getElementById("show-map"), {
            gestureHandling: "none",
            zoom: 13,
            center: myLatlng
        });
        let marker = new google.maps.Marker({
            position: myLatlng
        })
        marker.setMap(map);
    };
    $(() => {
        $("#delete-button").on('click', () => {
            Swal.fire({
                title: "Are you sure you want to delete this post?",
                text: "This cannot be undone",
                showCancelButton: true,
                confirmButtonText: "Delete Post",
                cancelButtonText: "Cancel Delete",

            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire();

                }
            });
        });
    });
    Swal.fire({
  title: 'Do you want to save the changes?',
  showDenyButton: true,
  showCancelButton: true,
  confirmButtonText: `Save`,
  denyButtonText: `Don't save`,
}).then((result) => {
  /* Read more about isConfirmed, isDenied below */
  if (result.isConfirmed) {
    Swal.fire('Saved!', '', 'success')
  } else if (result.isDenied) {
    Swal.fire('Changes are not saved', '', 'info')
  }
})
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= API_KEY %>&callback=showMap"></script>

<%- include('../partials/footer.ejs') %>
